---
title: "02_CD2F_Co-Registration"
author: "Tristan Caro"
date: "`r Sys.Date()`"
output: html_document
---

# Setup


## Clear the environment

```{r}
rm(list=ls())
```


## Load libraries

```{r}
library(tidyverse)
```

## Read from cache
```{r}
# Import the nanoSIMS Data
roi_data_joined <- readRDS("cache/roi_data_joined.RDS")

# Import the CD% data (NOT poly-smoothed)
cd_pc_summarized <- readRDS("cache/cd_pc_data_summarized.RDS")
```

## Join the data!

```{r}
co_registered <- roi_data_joined %>% 
  left_join(cd_pc_summarized,
            by = "cell_id") %>% 
  select(-c(`organism.y`)) %>% 
  # create an "Atom Percent" column
  mutate(
    # calculate fractional abundance
    frac2H = (`Ratio_2Hx1H` / 1 + `Ratio_2Hx1H`),
    # calculate fractional abundance (at%)
    at2H_percent = frac2H * 100
    )
```

```{r}
saveRDS(co_registered, "cache/co_registered.RDS")
```

