---
title: "Error Propagation"
subtitle: "Âµ errors generated by CD% uncertainty"
author: "Tristan Caro"
date: "Last knitted `r format(Sys.Date(), '%d %b %Y')`"
output:
  html_document: 
    df_print: paged
    number_sections: yes
    toc: yes
    toc_float: true
    toc_depth: 3
    code_folding: show
editor_options:
  chunk_output_type: console # switch to 'inline' if preferred
---

# Setup

```{r "setup", message = FALSE}
# packages
library(tidyverse) # CRAN v1.3.1 


# global knitting options for code rendering
knitr::opts_chunk$set(
  collapse = TRUE, comment = "#>",
  dev = c("png", "pdf"),
  dev.args = list(pdf = list(encoding = "WinAnsi", useDingbats = FALSE)),
  fig.keep = "all",
  fig.path = file.path("plots", paste0(gsub("\\.[Rr]md", "", knitr::current_input()), "_"))
)
```


# Generate a test dataset
Turnover is calculated as below:

$$
\mu = - \frac{1}{t} \cdot (ln (\frac{F_T - a \cdot F_L}{F_0 - a \cdot F_L})
$$

or in R-speak:
```
gencalc <- function(a, FT, F0, FL, t) {
  case_when(
    t == 0 ~ NA_real_,
    TRUE ~ - (1/t)*(log((FT - a*FL)/(F0 - a*FL)))
  )
}

```
where
- a is assimilation factor (0<a<1),
- FL is the isotopic composition of the tracer
- F0 is the isotopic composition starting biomass (likely natural abundance)
- FT is the isotopic composition of the biomass at time t
- t is time


```{r}
gencalc <- function(a, FT, F0, FL, t) {
  case_when(
    t == 0 ~ NA_real_,
    TRUE ~ - (1/t)*(log((FT - a*FL)/(F0 - a*FL)))
  )
}

gencalc_default <- function(a = 0.5, FT, F0 = 0.000015, FL, t = 3) {
  case_when(
    t == 0 ~ NA_real_,
    TRUE ~ - (1/t)*(log((FT - a*FL)/(F0 - a*FL)))
  )
}
```


```{r}
# Set random number seed
set.seed(5)

df_5at2H <- tibble(
  at2H_2sd = rnorm(n = 20, mean = 5, sd = 2),
  at2H_3sd = rnorm(n = 20, mean = 5, sd = 3),
  at2H_4sd = rnorm(n = 20, mean = 5, sd = 4),
  at2H_5sd = rnorm(n = 20, mean = 5, sd = 5),
  at2H_6sd = rnorm(n = 20, mean = 5, sd = 6),
  at2H_7sd = rnorm(n = 20, mean = 5, sd = 7),
  at2H_8sd = rnorm(n = 20, mean = 5, sd = 8),
  u_d_2sd = gencalc_default(FT = at2H_2sd, FL = 5),
  u_d_3sd = gencalc_default(FT = at2H_3sd, FL = 5),
  u_d_4sd = gencalc_default(FT = at2H_4sd, FL = 5),
  u_d_5sd = gencalc_default(FT = at2H_5sd, FL = 5),
  u_d_6sd = gencalc_default(FT = at2H_6sd, FL = 5),
  u_d_7sd = gencalc_default(FT = at2H_7sd, FL = 5),
  u_d_8sd = gencalc_default(FT = at2H_8sd, FL = 5),
)


rnorm(3, mean=10, sd=2)
```


